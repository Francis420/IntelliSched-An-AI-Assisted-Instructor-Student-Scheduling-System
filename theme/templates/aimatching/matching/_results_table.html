<!-- aimatching/matching/_results_table.html -->
<div class="overflow-x-auto">
  <table class="min-w-full border border-gray-300 text-sm">
    <thead>
      <tr class="bg-gray-200">
        <th class="px-3 py-2 border cursor-pointer" onclick="changeSort('rank')">Rank</th>
        <th class="px-3 py-2 border">Subject</th>
        <th class="px-3 py-2 border">Instructor</th>
        {% for col_key, col_label in columns %}
          <th class="px-3 py-2 border cursor-pointer" onclick="changeSort('{{ col_key }}')">
            {{ col_label }}
          </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for match in matches %}
        <tr class="hover:bg-gray-50">
          <td class="px-3 py-2 border text-center">
            {% if match.fixed_rank %}{{ match.fixed_rank }}{% else %}-{% endif %}
          </td>
          <td class="px-3 py-2 border">
            {{ match.subject.code }} - {{ match.subject.name }}
          </td>
          <td class="px-3 py-2 border">
            {{ match.full_name }}
          </td>
          {% for col_key, col_label in columns %}
            <td class="px-3 py-2 border text-center">
              {% if match.latestHistory %}
                {% if col_key == 'teaching' %}
                  {{ match.latestHistory.teachingScorePct|floatformat:1 }}%
                {% elif col_key == 'credentials' %}
                  {{ match.latestHistory.credentialScorePct|floatformat:1 }}%
                {% elif col_key == 'experience' %}
                  {{ match.latestHistory.experienceScorePct|floatformat:1 }}%
                {% elif col_key == 'preference' %}
                  {{ match.latestHistory.preferenceScorePct|floatformat:1 }}%
                {% elif col_key == 'total' %}
                  <span class="font-bold text-green-700">
                    {{ match.latestHistory.confidenceScorePct|floatformat:1 }}%
                  </span>
                {% endif %}
              {% else %}
                -
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% empty %}
        <tr>
          <td colspan="{{ 4|add:columns|length }}" class="px-3 py-4 text-center text-gray-500">
            No matching results found.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="mt-4 flex justify-center space-x-1">
  {% if matches.has_previous %}
    <a href="#" data-page="{{ matches.previous_page_number }}" class="px-3 py-1 border rounded live-page-link">&laquo;</a>
  {% endif %}
  {% for num in matches.paginator.page_range %}
    {% if matches.number == num %}
      <span class="px-3 py-1 border rounded bg-blue-500 text-white">{{ num }}</span>
    {% else %}
      <a href="#" data-page="{{ num }}" class="px-3 py-1 border rounded live-page-link">{{ num }}</a>
    {% endif %}
  {% endfor %}
  {% if matches.has_next %}
    <a href="#" data-page="{{ matches.next_page_number }}" class="px-3 py-1 border rounded live-page-link">&raquo;</a>
  {% endif %}
</div>

<script>
document.querySelectorAll('.toggle-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const row = btn.closest('td');
    const shortText = row.querySelector('.short-text');
    const fullText = row.querySelector('.full-text');

    if (fullText.classList.contains('hidden')) {
      shortText.classList.add('hidden');
      fullText.classList.remove('hidden');
      btn.textContent = 'Show less';
    } else {
      shortText.classList.remove('hidden');
      fullText.classList.add('hidden');
      btn.textContent = 'Show more';
    }
  });
});
</script>
