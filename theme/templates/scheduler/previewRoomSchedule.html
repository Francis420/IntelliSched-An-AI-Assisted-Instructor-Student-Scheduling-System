<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Preview: {{ room.roomCode }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        /* --- 1. PREVIEW MODE (Screen) --- */
        body {
            background-color: #525659; /* Dark Gray Background */
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Toolbar at top */
        .toolbar {
            width: 100%;
            background-color: #323639;
            color: white;
            padding: 12px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .printBtn {
            background-color: #8ab4f8; 
            color: #202124;
            border: none;
            padding: 8px 24px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* --- 2. PAPER SHEET (Screen View) --- */
        .pageContainer {
            background-color: white;
            width: 297mm; /* A4 Landscape */
            min-height: 210mm;
            padding: 10mm;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            margin-bottom: 50px;
            box-sizing: border-box;
        }

        /* --- 3. TABLE STYLES --- */
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        th, td {
            border: 1px solid black;
            padding: 2px;
            vertical-align: middle;
            text-align: center;
            height: 22px; /* Standard height for screen */
            overflow: hidden;
            font-size: 11px;
            color: black;
            white-space: nowrap;
        }
        
        th { background-color: #f0f0f0; font-weight: bold; }
        th:first-child, td:first-child { width: 70px; font-size: 10px; } 

        .lunchBreak {
            color: red; font-weight: bold; letter-spacing: 2px;
            border-top: 2px double black; border-bottom: 2px double black;
            background-color: #fff5f5; height: 30px;
        }

        .header { text-align: center; margin-bottom: 15px; color: black; }
        .header h3, .header h4, .header p { margin: 2px 0; font-weight: bold; text-transform: uppercase; }
        .subHeader { margin-top: 10px; font-weight: bold; text-align: center; color: black; font-size: 14px; }
        
        .footer { margin-top: 20px; margin-left: 20px; color: black; font-size: 12px; }
        .signatureLine { margin-top: 30px; font-weight: bold; text-decoration: underline; }

        /* --- 4. PRINT OPTIMIZATION --- */
        @media print {
            @page {
                size: landscape;
                margin: 5mm; /* Very narrow margins */
            }

            body {
                background-color: white;
                display: block;
                margin: 0;
                padding: 0;
                /* Ensure background colors (like lunch break) print */
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact;
            }

            .toolbar { display: none !important; }

            .pageContainer {
                width: 100%;
                /* CRITICAL FIX: Reset height so it doesn't force a full page */
                min-height: 0; 
                height: auto; 
                
                margin: 0;
                padding: 0;
                box-shadow: none;
                border: none;
                
                /* Keep the shrink to ensure width fits */
                transform: scale(0.98); 
                transform-origin: top center;
                overflow: hidden;
            }

            /* COMPACT MODE FOR PRINT */
            table { font-size: 12px; } /* Smaller font */
            
            th, td {
                height: 18px; /* Shorter rows (was 22px) */
                padding: 0px; /* Tighter padding */
            }

            .header { margin-bottom: 10px; } /* Compact header */
            .header h3 { font-size: 15px; }
            .header p { font-size: 10px; }
            
            .footer { margin-top: 15px; }

        }
    </style>
</head>
<body>

    <div class="toolbar">
        <button class="printBtn" onclick="window.print()">
            <i class="bi bi-printer-fill"></i> Print {{ room.roomCode }} Schedule
        </button>
    </div>

    <div class="pageContainer">
        
        <div class="header">
            <p>Republic of the Philippines</p>
            <h3>EASTERN VISAYAS STATE UNIVERSITY</h3>
            <p>Tacloban City</p>
            <br>
            <p>COLLEGE OF ENGINEERING - IT Department</p>
            <p>{{ semester.term }} Semester S.Y. {{ semester.academicYear }}</p>
            <div class="subHeader">{{ room.roomCode }} - {{ room.building }}</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>TIME</th>
                    {% for day in days %}
                        <th>{{ day|upper }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in gridRows %}
                    {% if row.isLunch %}
                        <tr class="lunchBreak">
                            <td>{{ row.label }}</td>
                            <td colspan="7">L U N C H B R E A K</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td>{{ row.timeLabel }}</td>
                            
                            {% for cell in row.cells %}
                                {% if cell.type == 'event' %}
                                    <td rowspan="{{ cell.rowSpan }}">
                                        <strong>{{ cell.subjectCode }} - {{ cell.section }}</strong><br>
                                        {{ cell.schedType }}<br>
                                        {{ cell.instructorName }}
                                    </td>
                                {% elif cell.type == 'empty' %}
                                    <td></td>
                                {% endif %}
                                {% endfor %}
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>

        <div class="footer">
            <div>Prepared by:</div>
            <br>
            <div class="signatureLine">
                {% if deptHead %}
                    {{ deptHead.full_name|upper }}
                {% else %}
                    [DEPT HEAD NOT SET]
                {% endif %}
            </div>
            <div>Department Head</div>
        </div>

    </div>

</body>
</html>