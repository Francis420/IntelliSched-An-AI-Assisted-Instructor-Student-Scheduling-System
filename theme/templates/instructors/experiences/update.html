{% extends 'base.html' %}

{% block title %}Update Professional Experience: {{ experience.title }}{% endblock %}
{% block header %}Update Professional Experience: {{ experience.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-10 bg-white p-8 rounded-xl shadow-md border border-gray-100">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">Update Experience</h2>

    <form method="POST" class="space-y-6">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="title" class="block mb-1 text-sm font-medium text-gray-700">Job Title / Role</label>
                <input type="text" name="title" id="title" value="{{ experience.title }}" required maxlength="100"
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
            </div>

            <div>
                <label for="organization" class="block mb-1 text-sm font-medium text-gray-700">Organization / Company</label>
                <input type="text" name="organization" id="organization" value="{{ experience.organization }}" required maxlength="100"
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
            </div>
        </div>

        <div>
            <label for="location" class="block mb-1 text-sm font-medium text-gray-700">Location</label>
            <input type="text" name="location" id="location" value="{{ experience.location }}" maxlength="100"
                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="experienceType" class="block mb-1 text-sm font-medium text-gray-700">Experience Type</label>
                <select name="experienceType" id="experienceType" required
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
                    {% for code, label in experience_types %}
                        <option value="{{ code }}" {% if code == experience.experienceType %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="employmentType" class="block mb-1 text-sm font-medium text-gray-700">Employment Type</label>
                <select name="employmentType" id="employmentType" required
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
                    {% for code, label in employment_types %}
                        <option value="{{ code }}" {% if code == experience.employmentType %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="startDate" class="block mb-1 text-sm font-medium text-gray-700">Start Date</label>
                <input type="date" name="startDate" id="startDate" value="{{ experience.startDate|date:'Y-m-d' }}" required
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
            </div>
            
            <div class="relative">
                <label for="endDate" class="block mb-1 text-sm font-medium text-gray-700">End Date</label>
                <input type="date" name="endDate" id="endDate" value="{{ experience.endDate|date:'Y-m-d'|default:'' }}"
                    class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">
                
                <div class="flex items-center mt-2">
                    <input id="isCurrent" name="isCurrent" type="checkbox" {% if experience.isCurrent %}checked{% endif %}
                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded cursor-pointer">
                    <label for="isCurrent" class="ml-2 block text-sm text-gray-900 cursor-pointer">
                        I currently work here
                    </label>
                </div>
            </div>
        </div>

        <div>
            <label for="relatedSubjects" class="block mb-1 text-sm font-medium text-gray-700">
                Related Subjects
            </label>
            <select name="relatedSubjects" id="relatedSubjects" multiple="multiple"
                class="w-full border-gray-300 rounded-lg shadow-sm p-2.5">
                {% for sub in subjects %}
                    <option value="{{ sub.subjectId }}" {% if sub.subjectId in selected_subjects %}selected{% endif %}>
                        {{ sub.code }} - {{ sub.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="description" class="block mb-1 text-sm font-medium text-gray-700">Description</label>
            <textarea name="description" id="description" rows="4"
                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary p-2.5">{{ experience.description }}</textarea>
        </div>

        <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
            <a href="{% url 'experienceList' %}" 
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                Cancel
            </a>
            <button type="submit"
                    class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition shadow-sm">
                Update Experience
            </button>
        </div>
    </form>
</div>

<script>
    $(document).ready(function() {
        // Init Select2
        $('#relatedSubjects').select2({
            placeholder: "Select subjects...",
            width: '100%',
            closeOnSelect: false
        });

        // Toggle End Date logic
        const isCurrentCheckbox = document.getElementById('isCurrent');
        const endDateInput = document.getElementById('endDate');

        function toggleEndDate() {
            if (isCurrentCheckbox.checked) {
                endDateInput.value = '';
                endDateInput.disabled = true;
                endDateInput.classList.add('bg-gray-100', 'cursor-not-allowed');
            } else {
                endDateInput.disabled = false;
                endDateInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
            }
        }

        isCurrentCheckbox.addEventListener('change', toggleEndDate);
        toggleEndDate(); // Run on load
    });
</script>
{% endblock %}