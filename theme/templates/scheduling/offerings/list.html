{% extends 'base.html' %}
{% block title %}Set Sections Per Subject{% endblock %}
{% block header %}Configure Sections Per Subject{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto mt-10 px-4 sm:px-6 lg:px-8">
  <form method="get" class="flex items-center gap-4 mb-6">
    <div>
      <label for="curriculum" class="mr-2 font-medium text-gray-700">Curriculum:</label>
      <select name="curriculum" id="curriculum"
              class="border border-gray-300 rounded-md py-2 px-3 focus:ring-blue-500 focus:border-blue-500"
              onchange="this.form.submit()">
        {% for cur in curricula %}
          <option value="{{ cur.curriculumId }}"
                  {% if cur == selected_curriculum %}selected{% endif %}>
            {{ cur.name }} ({{ cur.effectiveSy }})
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="semester" class="mr-2 font-medium text-gray-700">Semester:</label>
      <select name="semester" id="semester"
              class="border border-gray-300 rounded-md py-2 px-3 focus:ring-blue-500 focus:border-blue-500"
              onchange="this.form.submit()">
        {% for sem in semesters %}
          <option value="{{ sem.semesterId }}"
                  {% if sem == selected_semester %}selected{% endif %}>
            {{ sem.name }}
          </option>
        {% endfor %}
      </select>
    </div>
  </form>

  {% if selected_curriculum and selected_semester %}
  <form method="post"
        action="{% url 'generateSections' selected_semester.semesterId selected_curriculum.curriculumId %}"
        class="mb-6">
    {% csrf_token %}
    <button type="submit"
            class="flex items-center bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
      ⚙️ Generate Sections ({{ selected_semester.name }})
    </button>
  </form>
  {% endif %}

  {% for year, offerings_in_year in grouped_offerings %}
    <h2 class="text-lg font-bold mt-6 mb-3 text-gray-700">
      {{ year }}{% if year == 1 %}st{% elif year == 2 %}nd{% elif year == 3 %}rd{% else %}th{% endif %} Year
    </h2>

    {% if offerings_in_year %}
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm text-sm">
          <thead class="bg-gray-100 text-gray-700 uppercase tracking-wider text-xs">
            <tr>
              <th class="px-4 py-3 border-b">Code</th>
              <th class="px-4 py-3 border-b">Subject</th>
              <th class="px-4 py-3 border-b">Units</th>
              <th class="px-4 py-3 border-b">Sections</th>
              <th class="px-4 py-3 border-b">Semester</th>
              <th class="px-4 py-3 border-b text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for offering in offerings_in_year %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 border-b">{{ offering.subject.code }}</td>
                <td class="px-4 py-3 border-b">{{ offering.subject.name }}</td>
                <td class="px-4 py-3 border-b">{{ offering.subject.units }}</td>
                <td class="px-4 py-3 border-b">{{ offering.numberOfSections }}</td>
                <td class="px-4 py-3 border-b">{{ offering.semester.name }}</td>
                
                <td class="px-4 py-3 border-b">
                  <div class="flex flex-wrap justify-center gap-2">
                    <a href="{% url 'subjectOfferingUpdate' offering.id %}"
                       class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded-md text-xs whitespace-nowrap">
                      Set Count
                    </a>
                    <a href="{% url 'sectionConfigList' offering.id %}"
                       class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-xs whitespace-nowrap">
                      Set Students
                    </a>
                  </div>
                </td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-gray-500 mb-6">No offerings for this year.</p>
    {% endif %}
  {% endfor %}

</div>
{% endblock %}